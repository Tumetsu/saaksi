angular.module("saaksiApp.apiKey",[]),angular.module("lodash",[]).constant("_",window._),angular.module("metolib",[]).constant("metolib",window.fi.fmi.metoclient.metolib),angular.module("moment",[]).constant("moment",window.moment),angular.module("saaksiApp.dailyWeather",[]),angular.module("saaksiApp.fmi",[]),angular.module("saaksiApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngSanitize","ngTouch","ui.router","mm.foundation","lodash","metolib","moment","pascalprecht.translate","LocalStorageModule","720kb.datepicker","saaksiApp.dailyWeather","saaksiApp.fmi","pascalprecht.translate","angucomplete-alt","uiGmapgoogle-maps","ngAnimate","saaksiApp.apiKey"]).config(["$stateProvider","$translateProvider","$translatePartialLoaderProvider","$urlRouterProvider","localStorageServiceProvider","uiGmapGoogleMapApiProvider",function(a,b,c,d,e,f){f.configure({v:"3.20",libraries:"weather,geometry,visualization"}),c.addPart("home"),b.useLocalStorage(),b.useSanitizeValueStrategy("sanitizeParameters"),b.useLoader("$translatePartialLoader",{urlTemplate:"./i18n/{part}/{lang}.json"}),b.preferredLanguage("fi").fallbackLanguage("en"),e.setPrefix("saaksi").setStorageType("localStorage"),d.otherwise(""),a.state("app",{templateUrl:"views/app.html"}).state("app.download",{url:"",templateUrl:"views/download/download.html"}).state("app.download.apikey",{url:"/apikey",templateUrl:"src/apikey/apikey.html",controller:"ApikeyCtrl"}).state("app.download.dailyWeather",{url:"/dailyweather",templateUrl:"src/dailyWeather/dailyweather.html",controller:"DailyWeatherCtrl",apikeyRequired:!0}).state("app.download.seaLevel",{url:"/sealevel",templateUrl:"partials/download/sealevel.html",apikeyRequired:!0}).state("app.download.airQuality",{url:"/airquality",templateUrl:"partials/download/airquality.html",apikeyRequired:!0})}]).run(["$rootScope","$state","$translate","apikeyService",function(a,b,c,d){a.$on("$translatePartialLoaderStructureChanged",function(){c.refresh()}),a.$on("$stateChangeStart",function(c,e,f){e.apikeyRequired&&(d.getStoredKey()||(a.returnToState=e.name,b.transitionTo("app.download.apikey"),c.preventDefault()))})}]),angular.module("saaksiApp.apiKey").controller("ApikeyCtrl",["$scope","$rootScope","$state","$translatePartialLoader","apikeyService","fmiService",function(a,b,c,d,e,f){function g(){b.returnToState&&b.returnToState!==c.current.name?(c.transitionTo(b.returnToState),b.returnToState=null):(c.transitionTo("app.download"),b.returnToState=null)}d.addPart("apikey"),a.existingKey=Boolean(e.getStoredKey()),a.apikey=e.getStoredKey(),a.invalidKeyError=!1,a.setKey=function(){return a.apikey=a.apikey.replace(/\s/g,""),f.validateApiKey(a.apikey).then(function(b){b.err?a.invalidKeyError=!0:(e.setKeyToStorage(a.apikey),a.invalidKeyError=!1,g())})},a.clearKey=function(){e.removeApikey(),g()}}]),angular.module("saaksiApp.apiKey").service("apikeyService",["localStorageService",function(a){this.getStoredKey=function(){return a.get("apikey")},this.setKeyToStorage=function(b){a.set("apikey",b)},this.removeApikey=function(){return a.remove("apikey")}}]),angular.module("saaksiApp.apiKey").directive("apikeyValidator",["fmiService",function(a){return{require:"ngModel",restrict:"A",link:function(a,b,c,d){d.$validators.keyFormat=function(a){return/^([a-z0-9-]){25,}$/.test(a)}}}}]),angular.module("saaksiApp").directive("languageSwitch",["$translate",function(a){return{restrict:"E",template:'<a ng-click="changeLanguage()" translate>HOME.CHANGELANG</a>',replace:!0,link:function(b){b.changeLanguage=function(){var b=a.proposedLanguage()||a.use();b="fi"===b?"en":"fi",a.use(b)}}}}]),angular.module("saaksiApp.dailyWeather").controller("DailyWeatherCtrl",["$scope","$translatePartialLoader","$filter","apikeyService","fmiService","uiGmapGoogleMapApi","moment",function(a,b,c,d,e,f,g){b.addPart("dailyweather"),a.defaultDate=(new Date).toDateString(),a.stations=null,a.processStage=0,a.selectedStation=null,a.stationMarker={id:"stationMarker"},a.resetSelections=function(){a.selectedDataset={begin:"2014-04-25",end:"2014-04-25"},a.dateRange={begin:null,end:null,error:{begin:null,end:null}}},a.resetSelections(),a.setProcessStage=function(){a.selectedStation?a.selectedDataset.name?a.dateRange.error.begin||a.dateRange.error.end?a.processStage=2:a.processStage=3:a.processStage=1:a.processStage=0},e.getStationMetadata("weather").then(function(b){a.stations=b.data,a.dateMinLimit="2011/1/1"}),a.setDateLimits=function(){a.selectedDataset.end&&"Invalid Date"!==a.selectedDataset.end||(a.selectedDataset.end=new Date)},a.validateDates=function(b){var d=g.utc(b.begin,"DD.MM.YYYY",!0),e=g.utc(b.end,"DD.MM.YYYY",!0);return d>e?b.error.begin=c("translate")("DAILY.ERRORS.BEGIN_DATE_SMALLER_END"):d<g.utc(a.selectedDataset.begin)?b.error.begin=c("translate")("DAILY.ERRORS.BEGIN_DATE_BIGGER_EARLIEST"):e>g.utc(a.selectedDataset.end)?b.error.end=c("translate")("DAILY.ERRORS.END_DATE_SMALLER_LAST"):(b.error.begin=null,b.error.end=null),d.isValid()?e.isValid()||(b.error.end=c("translate")("DAILY.ERRORS.END_DATE_INVALID")):b.error.begin=c("translate")("DAILY.ERRORS.BEGIN_DATE_INVALID"),a.setProcessStage(),b},a.$watch("selectedStation",function(b,c){b&&(a.resetSelections(),a.setProcessStage(),a.map={center:{latitude:parseFloat(b.originalObject.lat),longitude:parseFloat(b.originalObject.lon)},zoom:7},a.stationMarker={coords:{latitude:parseFloat(b.originalObject.lat),longitude:parseFloat(b.originalObject.lon)},id:"stationMarker",options:{}})})}]),angular.module("saaksiApp.fmi").service("fmiService",["$window","$http","$q","metolib",function(a,b,c,d){new d.WfsConnection;this.validateApiKey=function(a){var d=c.defer();return b({url:"http://data.fmi.fi/fmi-apikey/"+a+"/wfs",method:"GET",params:{request:"getCapabilities"}}).then(function(a){d.resolve({err:null,data:a})},function(a){d.resolve({err:a,data:null})}),d.promise},this.regularHttpRequest=function(a,d){var e=c.defer();return b({url:"http://data.fmi.fi/fmi-apikey/"+a+"/wfs",method:"GET",params:{request:"getCapabilities"}}).then(function(a){e.resolve({err:null,data:a})},function(a){e.resolve({err:a,data:null})}),e.promise},this.getStationMetadata=function(a){var d=c.defer(),e={weather:null};return e.hasOwnProperty(a)?(b({url:"data/"+a+"_stations_metadata.json",method:"GET"}).then(function(a){d.resolve({err:null,data:a.data})},function(a){d.resolve({err:a,data:null})}),d.promise):(d.reject({err:new Error("Not a valid metadata type"),data:null}),d.promise)}}]),angular.module("saaksiApp").run(["$templateCache",function(a){"use strict";a.put("views/app.html",'<div class="topbar"> <div class="row"> <div class="large-12 columns"> <nav class="top-bar" data-topbar> <ul class="title-area"> <li class="name"> <h1> <a href="#"> Saaksi 0.1a </a> </h1> </li> <li class="toggle-topbar menu-icon"><a href="#"><span>menu</span></a></li> </ul> <section class="top-bar-section"> <ul class="right"> <li><language-switch></language-switch></li> </ul> </section> </nav> </div> </div> </div> <a href="https://github.com/Tumetsu/saaksi"><img style="position: absolute; top: 0; right: 0; border: 0" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a> <div ui-view></div> <footer class="row"> <div class="large-12 columns"> <hr> <div class="row"> <div class="large-6 columns"> <p translate>HOME.FOOTER.INFO</p> </div> <div class="large-6 columns"> <ul class="inline-list right"> <li><a href="https://github.com/Tumetsu/saaksi">Github</a></li> <li><a href="http://http://www.time-eater.net/">Tuomas Salmi</a></li> <li><a href="http://ilmatieteenlaitos.fi/">FMI</a></li> </ul> </div> </div> </div> </footer>'),a.put("views/download/download.html",'<div class="explanation-box"> <div class="row"> <div class="large-12 columns"> <!-- Explanation div --> <div> <h2 translate>HOME.HEADER</h2> <p translate>HOME.EXPLANATION</p> </div> </div> </div><br> </div> <!-- Actual content of a state --> <div class="row"> <div class="large-12 columns"> <div ui-view></div> </div> </div> <div class="row" style="padding-top: 2em; padding-bottom: 2em"> <div class="large-12 columns"> <div class="row"> <div class="large-4 small-6 columns"> <div class="card"> <a ui-sref="app.download.dailyWeather"> <div class="image"> <img src="./images/dailyweatherThumb.313ea597.jpg"> <span class="title" translate>HOME.TOPICS.DAILYWEATHER.HEADER</span> </div> </a> <div class="content"> <p translate>HOME.TOPICS.DAILYWEATHER.DESCRIPTION</p> </div> </div> </div> <div class="large-4 small-6 columns"> <div class="card"> <a ui-sref="app.download.seaLevel"> <div class="image"> <img src="./images/seaThumb.f3e21ad3.jpg"> <span class="title" translate>HOME.TOPICS.SEALEVELS.HEADER</span> </div> </a> <div class="content"> <p translate>HOME.TOPICS.SEALEVELS.DESCRIPTION</p> </div> </div> </div> <div class="large-4 small-6 columns"> <div class="card"> <a ui-sref="app.download.airQuality"> <div class="image"> <img src="./images/airQualityThumb.0da2b0f6.jpg"> <span class="title" translate>HOME.TOPICS.AIRQUALITY.HEADER</span> </div> </a> <div class="content"> <p translate>HOME.TOPICS.AIRQUALITY.DESCRIPTION</p> </div> </div> </div> </div> </div> </div> <div class="row"> <div class="large-12 columns"> <div class="row"> <div class="large-8 columns"> <div class="panel radius"> <div class="row"> <div class="large-6 small-6 columns"> <h4 translate>HOME.ABOUT.HEADER</h4><hr> <h5 class="subheader" translate>HOME.ABOUT.SHORT </h5> <div class="show-for-small" align="center"> <a href="#" class="small radius button">Call To Action!</a><br> <a href="#" class="small radius button">Call To Action!</a> </div> </div> <div class="large-6 small-6 columns"> <p translate>HOME.ABOUT.LONG</p> </div> </div> </div> </div> <div class="large-4 columns hide-for-small"> <h4 translate>HOME.OTHER.NOTHING</h4><hr> <a class="large button expand" href="#" translate> HOME.OTHER.BUTTON </a> <a class="large button expand" href="#" translate> HOME.OTHER.BUTTON </a> </div> </div> </div> </div>')}]);